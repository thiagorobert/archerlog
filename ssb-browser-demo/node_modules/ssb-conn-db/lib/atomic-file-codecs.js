"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.selfHealingJSONCodec = void 0;
exports.selfHealingJSONCodec = {
    encode: function (obj) {
        return JSON.stringify(obj, null, 2);
    },
    decode: function (input) {
        if (!input)
            return {};
        const str = input.toString();
        const MAX_TRIM = 10;
        let foundCorruption = false;
        for (let i = 0; i < MAX_TRIM; i++) {
            try {
                return JSON.parse(str.substring(0, str.length - i));
            }
            catch (err) {
                if (!foundCorruption) {
                    foundCorruption = true;
                    console.warn('WARNING: ssb-conn-db found a corrupted conn.json file ' +
                        'and is attempting to heal it');
                }
                continue;
            }
        }
        console.error('ERROR! ssb-conn-db failed to heal corrupted conn.json file');
        return {};
    },
};
